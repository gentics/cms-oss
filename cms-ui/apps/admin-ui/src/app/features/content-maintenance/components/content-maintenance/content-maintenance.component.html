<div class="maintenance-tab-content" [class.hide-sidebar]="activeTabId !== ContentMaintenanceTabs.GENERAL">

    <div class="sidebar sidebar-left">
        @if (activeTabId === ContentMaintenanceTabs.GENERAL) {
            <div class="sidebar-widget">
                <h2 class="widget-title">{{ 'widget.task_queue_title' | gtxI18n }}</h2>

                <div class="widget-content">
                    <gtx-progress-bar [active]="dirtQueueLoading"></gtx-progress-bar>

                    @if (dirtQueueError == null) {
                        <gtx-dirt-queue-summary
                            [summary]="dirtQueueSummary"
                            [failedTasks]="failedTasks"
                        ></gtx-dirt-queue-summary>
                    } @else {
                        <div class="error-message">{{ dirtQueueError }}</div>
                    }
                </div>
            </div>

            <div class="sidebar-widget">
                <h2 class="widget-title">{{ 'widget.task_publishing_process_title' | gtxI18n }}</h2>

                <div class="widget-content">
                    <gtx-progress-bar [active]="publishProcessLoading"></gtx-progress-bar>

                    @if (publishProcessError == null) {
                        <gtx-publish-process-summary
                            [info]="publishInfo"
                            [hasFailedJobs]="hasFailedSchedules"
                            [publisherStatus]="schedulerStatus"
                        ></gtx-publish-process-summary>
                    } @else {
                        <div class="error-message">{{ publishProcessError }}</div>
                    }
                </div>
            </div>
        }
    </div>

    <div class="main-content">
        <gtx-tabs pure [activeId]="activeTabId">
            <gtx-tab
                [id]="ContentMaintenanceTabs.GENERAL"
                [title]="'content_maintenance.title_general' | gtxI18n"
                (select)="changeTab($event)"
            >
                @if (nodesError == null) {
                    <gtx-node-publish-process-table
                        [showSearch]="true"
                        [publishQueue]="publishQueue"
                        [nodes]="nodes"
                        [nodesLoading]="nodesLoading"
                        [(selected)]="selectedNodeIds"
                        (actionClick)="handleTableAction($event)"
                    ></gtx-node-publish-process-table>
                } @else {
                    <div class="error-message">{{ nodesError }}</div>
                }
            </gtx-tab>

            <gtx-tab
                [id]="ContentMaintenanceTabs.FAILED_TASKS"
                [title]="'content_maintenance.title_failedTasks' | gtxI18n"
                (select)="changeTab($event)"
            >
                <gtx-dirt-queue-item-table
                    [showSearch]="true"
                ></gtx-dirt-queue-item-table>
            </gtx-tab>
        </gtx-tabs>
    </div>

    <div class="sidebar sidebar-right">
        @if (activeTabId === ContentMaintenanceTabs.GENERAL) {
            <div class="maintanance-buttons">
                <gtx-button
                    class="reload-button"
                    flat
                    size="small"
                    type="primary"
                    [disabled]="dirtQueueLoading || publishProcessLoading || nodesLoading || publishQueueLoading"
                    (click)="loadData()"
                >
                    <icon left>refresh</icon> {{ 'common.reload_table_button' | gtxI18n }}
                </gtx-button>

                <gtx-button
                    class="reload-button"
                    flat
                    size="small"
                    type="primary"
                    [disabled]="!modifyPermissions || working"
                    (click)="reloadConfiguration()"
                >
                    <icon left>settings_applications</icon> {{ 'content_maintenance.reload_configuration' | gtxI18n }}
                </gtx-button>

                <gtx-button
                    class="reload-button"
                    flat
                    size="small"
                    type="primary"
                    [disabled]="!modifyPermissions || working"
                    (click)="stopPublishing()"
                >
                    <icon left>highlight_off</icon> {{ 'content_maintenance.stop_publishing' | gtxI18n }}
                </gtx-button>
            </div>

            <div class="sidebar-widget">
                <h2 class="widget-title">{{ 'widget.widget_publishing_process_total_title' | gtxI18n }}</h2>

                <div class="widget-content">
                    <gtx-progress-bar [active]="publishQueueLoading"></gtx-progress-bar>

                    @if (publishQueueError == null) {
                        <gtx-publish-queue-summary
                            [nodes]="nodes"
                            [publishQueue]="publishQueue"
                        ></gtx-publish-queue-summary>
                    } @else {
                        <div class="error-message">{{ publishQueueError }}</div>
                    }
                </div>
            </div>
        }
    </div>
</div>
