@if (tagProperty) {
  <div class="tag-part-editor">
    <span class="tag-prop-label">{{ tagPart | tagPropLabel }}</span>
    <div class="options-row">
      <gtx-select
        class="overview-property"
        data-control="listType"
        [label]="'tag_editor.list_type_selector' | gtxI18n"
        [required]="true"
        [disabled]="allowedListTypes.length < 2 || context.readOnly"
        [(ngModel)]="tagProperty.overview.listType"
        (valueChange)="onSelectedListOrSelectTypeChange()"
        >
        @for (listType of allowedListTypes; track listType.value) {
          <gtx-option [value]="listType.value">
            {{ listType.label | gtxI18n }}
          </gtx-option>
        }
      </gtx-select>
      <gtx-select
        class="overview-property"
        data-control="selectType"
        [label]="'tag_editor.select_type_selector' | gtxI18n"
        [required]="true"
        [disabled]="allowedSelectTypes.length < 2 || context.readOnly"
        [(ngModel)]="tagProperty.overview.selectType"
        (valueChange)="onSelectedListOrSelectTypeChange()"
        >
        @for (selectType of allowedSelectTypes; track selectType.value) {
          <gtx-option [value]="selectType.value">
            {{ selectType.label | gtxI18n }}
          </gtx-option>
        }
      </gtx-select>
      @if (!tagPart.overviewSettings.hideSortOptions) {
        <gtx-select
          class="overview-property"
          data-control="orderBy"
          [disabled]="allowedOrderByTypes.length < 2 || context.readOnly"
          [label]="'tag_editor.order_by_type_selector' | gtxI18n"
          [required]="true"
          [(ngModel)]="tagProperty.overview.orderBy"
          (valueChange)="onUserChange()"
          >
          @for (orderByType of allowedOrderByTypes; track orderByType.value) {
            <gtx-option [value]="orderByType.value">
              {{ orderByType.label | gtxI18n }}
            </gtx-option>
          }
        </gtx-select>
        <gtx-select
          class="overview-property"
          data-control="orderDirection"
          [label]="'tag_editor.order_direction_selector' | gtxI18n"
          [required]="true"
          [disabled]="allowedOrderDirections.length < 2 || context.readOnly"
          [(ngModel)]="tagProperty.overview.orderDirection"
          (valueChange)="onUserChange()"
          >
          @for (orderDirection of allowedOrderDirections; track orderDirection.value) {
            <gtx-option [value]="orderDirection.value">
              {{ orderDirection.label | gtxI18n }}
            </gtx-option>
          }
        </gtx-select>
      }
    </div>
    @if (tagProperty.overview.selectType === selectTypeEnum.FOLDER
      || tagProperty.overview.selectType === selectTypeEnum.AUTO
      || tagProperty.overview.selectType === selectTypeEnum.FOLDER) {
      <div
        class="options-row"
        >
        @if (tagProperty.overview.selectType === selectTypeEnum.FOLDER
          || tagProperty.overview.selectType === selectTypeEnum.AUTO) {
          <gtx-input
            class="overview-property input-property"
            type="number"
            min="0"
            max="999999999"
            [label]="'tag_editor.overview_max_items' | gtxI18n"
            [required]="true"
            [pattern]="'^[0-9]+$'"
            [readonly]="context.readOnly"
            [(ngModel)]="tagProperty.overview.maxItems"
            (valueChange)="onMaxItemsChange($event)"
          ></gtx-input>
        }
        @if (tagProperty.overview.listType === listTypeEnum.FOLDER
          || tagProperty.overview.selectType === selectTypeEnum.FOLDER) {
          <gtx-checkbox
            class="overview-property checkbox-property"
            [label]="'tag_editor.overview_recursive' | gtxI18n"
            [disabled]="context.readOnly"
            [(ngModel)]="tagProperty.overview.recursive"
            (change)="onUserChange()"
          ></gtx-checkbox>
        }
      </div>
    }
    @if (areSelectedItemsVisible(tagProperty.overview)) {
      <div class="browse-button-cell">
        <gtx-button
          data-action="browse-items"
          type="secondary"
          [disabled]="context.readOnly"
          (click)="browseForItems()"
          >
          {{ 'tag_editor.overview_add_items' | gtxI18n }}
        </gtx-button>
      </div>
      @if (selectedItems.length > 0) {
        <sortable-array-list
          class="overview-items"
          [allowDrag]="tagProperty.overview.orderBy === 'SELF' && !context.readOnly"
          [allowRemoval]="!context.readOnly"
          [(ngModel)]="selectedItems"
          (orderChange)="onUserChange()"
          (itemRemove)="onUserChange()"
          >
          <ng-template let-item="item" let-index="index">
            <div
              class="overview-item"
              [attr.data-type]="item.type"
              [attr.data-id]="item.id"
              [attr.data-node-id]="item._checkedNodeId || item.nodeId"
              >
              @if (item.type) {
                <span class="item-icon" [ngClass]="item.type || ''">
                  <icon>{{ item.type | gtxTypeIcon }}</icon>
                </span>
              }
              <ng-template #itemPathTpl let-path="path">
                <span class="item-path" [title]="path">{{ path }}</span>
              </ng-template>
              @switch (item.type) {
                @case ('folder') {
                  <ng-container
                    [ngTemplateOutlet]="itemPathTpl"
                    [ngTemplateOutletContext]="{ path: item.path }"
                  ></ng-container>
                }
                @case ('channel') {
                  <ng-container
                    [ngTemplateOutlet]="itemPathTpl"
                    [ngTemplateOutletContext]="{ path: item.name}"
                  ></ng-container>
                }
                @case ('node') {
                  <ng-container
                    [ngTemplateOutlet]="itemPathTpl"
                    [ngTemplateOutletContext]="{ path: item.name }"
                  ></ng-container>
                }
                @default {
                  <ng-container
                    [ngTemplateOutlet]="itemPathTpl"
                    [ngTemplateOutletContext]="{ path: (item.path || '') + item.name }"
                  ></ng-container>
                }
              }
            </div>
          </ng-template>
        </sortable-array-list>
      } @else {
        <div class="no-items-label">
          {{ 'tag_editor.overview_no_items_selected' | gtxI18n }}
        </div>
      }
    }
  </div>
}
