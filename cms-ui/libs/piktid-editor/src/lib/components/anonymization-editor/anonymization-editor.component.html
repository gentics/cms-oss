<gtxpict-image-preview
    *ngIf="imageUrl"
    class="image-preview"
    [originalImageUrl]="imageUrl"
    [editedImageUrl]="editedImageUrl"
    [activeImage]="activeImage"
    [faceIds]="faceIds"
    [facePositions]="facePositions"
    (activeImageChange)="onTabChange($event)"
></gtxpict-image-preview>

<div class="controls">
    <ng-container *ngIf="imageId; else notUploaded">
        <div class="management-controls">
            <gtx-button
                type="success"
                size="small"
                [disabled]="!imageUrl || busy || uploading || waitingForFaces.size > 0 || confirmedFaces.size === 0"
                (click)="confirmChanges()"
            >{{ 'confirm_changes' }}</gtx-button>
        </div>

        <div *ngIf="faceIds.length > 0" class="face-manipulation-list">
            <gtxpict-face-manipulation
                *ngFor="let faceId of faceIds"
                [faceId]="faceId"
                [progress]="faceProgress[faceId]"
                [generations]="faceGenerations[faceId]"
                [selectedGeneration]="selectedGeneration[faceId]"
                [waiting]="waitingForFaces | gtxIncludes:faceId"
                [confirmed]="confirmedFaces | gtxIncludes:faceId"
                (generationSelected)="selectGeneration(faceId, $event)"
                (generationConfirmed)="confirmFaceGeneration(faceId)"
                (generateNewFace)="generateFace(faceId)"
                (undoGeneration)="undoFaceGeneration(faceId)"
            ></gtxpict-face-manipulation>
        </div>
    </ng-container>

    <ng-template #notUploaded>
        <div class="not-uploaded">
            <gtx-button
                type="primary"
                [disabled]="!imageUrl || busy || uploading"
                (click)="triggerUpload()"
            >{{ 'upload_image' }}</gtx-button>
        </div>
    </ng-template>
</div>
