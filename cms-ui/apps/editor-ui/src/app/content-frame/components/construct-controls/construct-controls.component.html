<div class="content">
    <ng-container *ngIf="!gcnPlugin; else loadedContent">
        <div class="loading-placeholder">{{ 'editor.constructs_loading' | i18n }}</div>
    </ng-container>
</div>

<ng-template #loadedContent>
    <gtx-dropdown-list
        #dropdown
        class="dropdown"
        [belowTrigger]="false"
        [sticky]="true"
        [width]="'trigger'"
        [disabled]="true"
    >
        <gtx-dropdown-trigger>
            <div class="construct-overview">
                <ng-container *ngIf="noCategroyConstructs.length > 0; else noUncategorizedConstructs">
                    <ng-container *ngTemplateOutlet="constructs; context: { list: noCategroyConstructs }"></ng-container>
                </ng-container>
                <ng-template #noUncategorizedConstructs>
                    <div class="no-elements">
                        {{ 'editor.constructs_no_uncategorized' | i18n }}
                    </div>
                </ng-template>
            </div>
        </gtx-dropdown-trigger>

        <gtx-dropdown-content>
            <div class="full-view-wrapper">
                <div class="inner-view-wrapper">
                    <div class="groups-container">
                        <div
                            *ngFor="let group of groups"
                            class="construct-group"
                            [attr.data-id]="group.id"
                        >
                            <div *ngIf="group.label" class="group-label">
                                {{ group.label }}
                            </div>
                            <div class="group-entries">
                                <ng-template *ngTemplateOutlet="constructs; context: { list: group.constructs }"></ng-template>
                            </div>
                        </div>

                        <div *ngIf="groups.length === 0" class="no-elements">
                            {{ 'editor.constructs_no_results' | i18n }}
                        </div>
                    </div>

                    <div class="search-bar">
                        <gtx-search-bar
                            [query]="filterText"
                            (change)="updateFilterText($event)"
                            (clear)="updateFilterText('')"
                        ></gtx-search-bar>
                    </div>
                </div>
            </div>
        </gtx-dropdown-content>
    </gtx-dropdown-list>

    <gtx-button
        class="dropdown-toggle"
        icon
        [disabled]="availableConstructs.length === 0"
        (click)="openDropdown()"
    >
        <icon>keyboard_arrow_down</icon>
    </gtx-button>
</ng-template>

<ng-template #constructs let-list="list">
    <ng-container *ngFor="let construct of list">
        <gtx-tooltip
            position="bottom"
            align="left"
            type="light"
        >
            <button
                gtx-tooltip-trigger
                class="format-button construct"
                [attr.data-keyword]="construct.keyword"
                [attr.data-id]="construct.id"
                [disabled]="disabled || !active"
                (click)="insertConstructIntoPage(construct)"
            >
                <div class="construct-icon">
                    <icon>{{ construct | gtxConstructIconNormalizer }}</icon>
                </div>
                <div class="construct-name">
                    {{ construct.name }}
                </div>
            </button>

            <div class="construct-tooltip-details" gtx-tooltip-content>
                <h3 class="constuct-keyword">{{ construct.keyword }}</h3>
                <div *ngIf="construct.description" class="construct-description">{{ construct.description }}</div>
            </div>
        </gtx-tooltip>
    </ng-container>
</ng-template>
