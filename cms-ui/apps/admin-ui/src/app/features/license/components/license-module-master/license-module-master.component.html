<gtx-progress-bar [active]="loading" />

<h1>{{ 'dashboard.license_management' | i18n }}</h1>

<div class="action-button-row">
    <gtx-button
        class="action-button upload-button"
        flat
        size="small"
        type="warning"
        data-action="upload"
        [disabled]="loading"
        (click)="openUploadModal()"
    >
        <icon left>upload</icon> {{ 'license.upload_license' | i18n }}
    </gtx-button>

    <gtx-button
        class="action-button reload-button"
        flat
        size="small"
        type="primary"
        data-action="reload"
        [disabled]="loading"
        (click)="loadLicenseInfo()"
    >
        <icon left>refresh</icon> {{ 'common.reload_table_button' | i18n }}
    </gtx-button>
</div>

<table *ngIf="!loading" class="overview-table">
    <tbody>
        <tr data-id="status">
            <td>{{ 'license.status' | i18n }}</td>
            <td>{{ ('license.status_' + status) | i18n }}</td>
        </tr>
        <ng-container *ngIf="license">
            <tr data-id="uuid">
                <td>{{ 'license.uuid' | i18n }}</td>
                <td><code>{{ license.uuid }}</code></td>
            </tr>
            <tr data-id="issuedAt">
                <td>{{ 'license.issuedAt' | i18n }}</td>
                <td>{{ license.issuedAt | i18nDate }}</td>
            </tr>
            <tr data-id="validUntil">
                <td>{{ 'license.validUntil' | i18n }}</td>
                <td>{{ license.validUntil > 0 ? (license.validUntil | i18nDate) : ('license.unlimitedValidity' | i18n) }}</td>
            </tr>
        </ng-container>
    </tbody>
</table>

<gtx-accordion *ngIf="license" [trigger]="featureLabel">
    <gtx-progress-bar [active]="loading" />

    <table *ngIf="!loading" class="feature-table">
        <thead>
            <tr>
                <th>{{ 'license.featureName' | i18n }}</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let feat of license.features | gtxEntries" [attr.data-id]="feat.key">
                <td>{{ feat.value }}</td>
            </tr>
        </tbody>
    </table>
</gtx-accordion>

<ng-template #featureLabel>
    <h2 class="accordion-text">{{ 'license.features' | i18n }}</h2>
</ng-template>
