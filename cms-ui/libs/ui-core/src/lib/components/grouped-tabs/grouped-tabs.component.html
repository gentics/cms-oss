<div class="grouped-tabs">
  <ul class="collapsible expandable" [class.wrap-tab-title]="wrap">
    @for (tabItem of tabs$ | async; track (tabItem.id || tabItem.UNIQUE_ID)) {
      @if (tabItem.expand != null) {
        <li
          class="tab-group"
          [attr.data-id]="tabItem.id || tabItem.UNIQUE_ID"
          [class.expanded]="tabItem.expand"
          [class.is-active]="tabItem.hasActiveChild"
          >
          <div class="collapsible-header" (click)="toggleGroup(tabItem)">
            <ng-container *ngTemplateOutlet="labelTemplate;context:{tabItem: tabItem}"></ng-container>
          </div>
          <div class="collapsible-body">
            @if (tabItem.tabs.length > 0) {
              <ul class="tab-links">
                @for (tab of tabItem.tabs; track (tab.id || tab.UNIQUE_ID)) {
                  <ng-container *ngTemplateOutlet="tabItemTemplate;context:{tabItem: tab}"></ng-container>
                }
              </ul>
            }
          </div>
        </li>
      } @else {
        <ng-container *ngTemplateOutlet="tabItemTemplate;context:{tabItem: tabItem}">
        </ng-container>
      }
    }
  </ul>
</div>

<div class="grouped-tab-content">
  <ng-container *ngTemplateOutlet="currentTab?.content"></ng-container>
</div>

<ng-template #labelTemplate let-tabItem="tabItem">
  @if (tabItem?.expand != null) {
    <icon class="header-icon">keyboard_arrow_right</icon>
  }

  <!-- If there is a label template, use it. -->
  @if (tabItem.templateLabel) {
    <ng-container *ngTemplateOutlet="tabItem.templateLabel"></ng-container>
  } @else {
    <span class="tab-label">{{ tabItem.label || tabItem.textLabel }}</span>
  }

  <!-- If there is not a label template, fall back to the text label. -->
</ng-template>

<ng-template #tabItemTemplate let-tabItem="tabItem">
  <li
    class="tab-link"
    role="presentation"
    [attr.data-id]="tabItem.id || tabItem.UNIQUE_ID"
    [class.disabled]="tabItem.disabled"
    [class.is-active]="tabItem.active"
    [class.readonly]="tabItem.readonly"
    [class.inactive]="tabItem.inactive"
    [class.status-icon]="!tabItem.disabled && statusIcons && !tabItem.hideStatusIcon"
    (click)="selectTab(tabItem)"
    >
    @if (!tabItem.disabled && statusIcons && !tabItem.hideStatusIcon) {
      <i class="statusIcon"></i>
    }
    <a role="tab">
      <ng-container *ngTemplateOutlet="labelTemplate;context:{tabItem: tabItem}"></ng-container>
    </a>
  </li>
</ng-template>
